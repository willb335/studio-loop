---
import { Image } from 'astro:assets';
import FitnessFollowupLogo from '../assets/kettlebell-envelope-icon.svg';
/**
 * Navigation component aligned with refined hero aesthetic
 *
 * Features:
 * - Frosted glass surface with radial glow and sticky positioning
 * - Desktop: centered nav links with animated underline, gradient CTA
 * - Mobile: glassmorphism overlay with slide panel and tactile controls
 * - Smooth motion with reduced-motion accommodation and scroll locking
 */
---

<nav class="sticky top-0 z-50" role="navigation" aria-label="Main navigation">
  <div class="nav-surface">
    <div class="nav-inner">
      <button
        onclick="window.scrollTo({ top: 0, behavior: 'smooth' })"
        class="brand-button"
        aria-label="FitnessFollowup - Scroll to top of page"
      >
        <span class="brand-logo">
          <Image
            src={FitnessFollowupLogo}
            alt="FitnessFollowup logo"
            width={60}
            height={60}
            loading="eager"
            class="logo-img"
          />
        </span>
        <span class="brand-name" aria-hidden="true">FitnessFollowup</span>
      </button>

      <div class="nav-links">
        <button
          onclick="document.getElementById('features').scrollIntoView({ behavior: 'smooth' })"
          class="nav-link"
          aria-label="Navigate to Features section"
        >
          Features
          <span aria-hidden="true"></span>
        </button>
        <button
          onclick="document.getElementById('how-it-works').scrollIntoView({ behavior: 'smooth' })"
          class="nav-link"
          aria-label="Navigate to How It Works section"
        >
          How It Works
          <span aria-hidden="true"></span>
        </button>
        <button
          onclick="document.getElementById('faq').scrollIntoView({ behavior: 'smooth' })"
          class="nav-link"
          aria-label="Navigate to FAQ section"
        >
          FAQ
          <span aria-hidden="true"></span>
        </button>
      </div>

      <button
        onclick="document.getElementById('waitlist').scrollIntoView({ behavior: 'smooth' })"
        class="cta-pill desktop-cta"
        aria-label="Navigate to waitlist signup form"
      >
        Join Waitlist
      </button>

      <button
        id="mobile-menu-button"
        class="mobile-trigger"
        aria-label="Toggle menu"
        aria-expanded="false"
      >
        <span></span>
      </button>
    </div>
  </div>
</nav>

<div
  id="mobile-menu"
  class="mobile-overlay"
  aria-hidden="true"
>
  <div class="mobile-panel">
    <div class="mobile-links">
      <button class="mobile-link" data-section="features">
        Features
        <span aria-hidden="true">→</span>
      </button>
      <button class="mobile-link" data-section="how-it-works">
        How It Works
        <span aria-hidden="true">→</span>
      </button>
      <button class="mobile-link" data-section="faq">
        FAQ
        <span aria-hidden="true">→</span>
      </button>
    </div>

    <div class="mobile-cta-wrapper">
      <button
        class="cta-pill mobile-cta"
        data-section="waitlist"
      >
        Join Waitlist
      </button>
      <p class="mobile-meta">Limited beta · 20 spots left</p>
    </div>
  </div>
</div>

<script>
  const mobileMenuButton = document.getElementById('mobile-menu-button');
  const mobileMenu = document.getElementById('mobile-menu');
  const mobileMenuLinks = document.querySelectorAll('.mobile-link');
  const navRoot = document.querySelector('nav[role="navigation"]');

  let isMenuOpen = false;

  const lockScroll = () => {
    const scrollY = window.scrollY || window.pageYOffset;
    document.body.dataset.scrollLock = 'true';
    document.body.style.top = `-${scrollY}px`;
    document.body.classList.add('lock-scroll');
  };

  const unlockScroll = () => {
    const scrollPosition = document.body.style.top;
    document.body.classList.remove('lock-scroll');
    document.body.style.top = '';
    document.body.dataset.scrollLock = 'false';
    const y = scrollPosition ? parseInt(scrollPosition, 10) * -1 : 0;
    window.scrollTo(0, y);
  };

  const toggleMenu = () => {
    isMenuOpen = !isMenuOpen;

    mobileMenu?.classList.toggle('mobile-overlay--open', isMenuOpen);
    mobileMenuButton?.classList.toggle('mobile-trigger--active', isMenuOpen);
    navRoot?.classList.toggle('nav--overlay', isMenuOpen);

    mobileMenuButton?.setAttribute('aria-expanded', isMenuOpen ? 'true' : 'false');
    mobileMenu?.setAttribute('aria-hidden', isMenuOpen ? 'false' : 'true');

    if (isMenuOpen) {
      lockScroll();
    } else {
      unlockScroll();
    }
  };

  const scrollToSection = (sectionId: string) => {
    const section = document.getElementById(sectionId);
    if (!section) {
      return;
    }

    if (isMenuOpen) {
      toggleMenu();
      window.requestAnimationFrame(() => {
        window.requestAnimationFrame(() => {
          section.scrollIntoView({ behavior: 'smooth', block: 'start' });
        });
      });
      return;
    }

    section.scrollIntoView({ behavior: 'smooth', block: 'start' });
  };

  mobileMenuButton?.addEventListener('click', toggleMenu);
  mobileMenuLinks.forEach((link) => {
    link.addEventListener('click', (event: Event) => {
      const target = event.currentTarget as HTMLElement | null;
      if (!target) {
        return;
      }
      const sectionId = target.getAttribute('data-section');
      if (sectionId) {
        scrollToSection(sectionId);
      }
    });
  });

  mobileMenu?.addEventListener('click', (event) => {
    if (event.target === mobileMenu && isMenuOpen) {
      toggleMenu();
    }
  });

  document.addEventListener('keydown', (event) => {
    if (event.key === 'Escape' && isMenuOpen) {
      toggleMenu();
    }
  });

  const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)');
  if (prefersReducedMotion.matches) {
    document.documentElement.classList.add('reduce-motion');
  }
</script>

<style>
  :root {
    --nav-border: rgba(229, 231, 235, 0.9);
    --nav-gradient: radial-gradient(120% 120% at 50% 0%, rgba(251, 113, 133, 0.16), rgba(255, 255, 255, 0.85));
    --nav-bg: rgba(255, 255, 255, 0.8);
    --nav-shadow: 0 18px 40px -24px rgba(15, 23, 42, 0.28);
    --link-color: rgba(31, 41, 55, 0.78);
    --link-hover: rgba(190, 24, 93, 0.95);
    --cta-gradient: linear-gradient(135deg, rgb(251, 113, 133) 0%, rgb(244, 63, 94) 100%);
    --cta-shadow: 0 12px 24px -12px rgba(244, 63, 94, 0.55);
    --overlay-bg: rgba(248, 250, 252, 0.68);
    --overlay-gradient: radial-gradient(140% 100% at 50% 0%, rgba(251, 113, 133, 0.14), rgba(255, 255, 255, 0.92));
  }

  .nav-surface {
    position: relative;
    padding: 0.4rem 0;
    background: var(--nav-bg);
    backdrop-filter: blur(24px) saturate(160%);
    border-bottom: 1px solid var(--nav-border);
    box-shadow: var(--nav-shadow);
    transition: background 200ms ease, border-color 200ms ease;
  }

  .nav-inner {
    max-width: 1120px;
    margin: 0 auto;
    padding: 0 1.25rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1.25rem;
  }

  .nav-surface::before {
    content: '';
    position: absolute;
    inset: -120px 0 auto;
    height: 180px;
    background: var(--nav-gradient);
    pointer-events: none;
    z-index: -1;
  }

  .brand-button {
    display: inline-flex;
    align-items: center;
    gap: 0.6rem;
    padding: 0.35rem 0.9rem 0.35rem 0.6rem;
    border-radius: 999px;
    background: rgba(255, 255, 255, 0.7);
    border: 1px solid rgba(251, 113, 133, 0.18);
    box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.6);
    cursor: pointer;
    transition: transform 180ms ease, box-shadow 180ms ease, border-color 180ms ease;
  }

  .brand-button:hover,
  .brand-button:focus-visible {
    transform: translateY(-1px);
    border-color: rgba(251, 113, 133, 0.4);
    box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.8), 0 8px 18px -12px rgba(244, 63, 94, 0.35);
  }

  .brand-button:focus-visible {
    outline: 2px solid rgba(244, 63, 94, 0.5);
    outline-offset: 2px;
  }

  .brand-logo {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 0.1rem;
    border-radius: 999px;
    background: linear-gradient(135deg, rgba(255, 241, 242, 0.85), rgba(255, 255, 255, 0.95));
    box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.6), 0 6px 14px -10px rgba(244, 63, 94, 0.4);
  }

  .logo-img {
    display: inline-flex;
  }

  :global(.logo-img img) {
    width: 3.5rem;
    height: 3.5rem;
  }

  .brand-name {
    font-family: var(--font-heading);
    font-size: 1.15rem;
    font-weight: 600;
    letter-spacing: -0.01em;
    color: rgba(0, 0, 0);
  }

  .nav-links {
    display: none;
    justify-self: center;
    gap: 1.75rem;
  }

  .nav-link {
    position: relative;
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    color: var(--link-color);
    font: 500 0.97rem/1.4 "Inter", system-ui, -apple-system, sans-serif;
    letter-spacing: -0.01em;
    transition: color 160ms ease;
    cursor: pointer;
  }

  .nav-link span {
    position: absolute;
    left: 0;
    bottom: -0.55rem;
    width: 100%;
    height: 2px;
    border-radius: 999px;
    background: var(--link-hover);
    transform: scaleX(0);
    transform-origin: center;
    transition: transform 220ms ease;
  }

  .nav-link:hover,
  .nav-link:focus-visible {
    color: var(--link-hover);
  }

  .nav-link:hover span,
  .nav-link:focus-visible span {
    transform: scaleX(1);
  }

  .nav-link:focus-visible {
    outline: 2px solid rgba(244, 63, 94, 0.45);
    outline-offset: 6px;
  }

  .cta-pill {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 0.8rem 1.6rem;
    border-radius: 999px;
    border: none;
    background: var(--cta-gradient);
    color: #fff;
    font: 600 0.98rem/1 "Inter", system-ui, -apple-system, sans-serif;
    letter-spacing: -0.01em;
    box-shadow: var(--cta-shadow);
    transition: transform 160ms ease, box-shadow 160ms ease, filter 160ms ease;
    cursor: pointer;
  }

  .cta-pill::after {
    content: '';
    width: 10px;
    height: 10px;
    border-radius: 999px;
    background: rgba(255, 255, 255, 0.38);
    box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.18);
  }

  .cta-pill:hover,
  .cta-pill:focus-visible {
    transform: translateY(-1px);
    box-shadow: 0 16px 28px -20px rgba(244, 63, 94, 0.7);
    filter: brightness(1.03);
  }

  .cta-pill:focus-visible {
    outline: 2px solid rgba(255, 255, 255, 0.6);
    outline-offset: 4px;
  }

  .mobile-trigger {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 2.6rem;
    height: 2.6rem;
    border-radius: 999px;
    border: 1px solid rgba(15, 23, 42, 0.08);
    background: rgba(255, 255, 255, 0.78);
    box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.45);
    cursor: pointer;
    transition: border-color 160ms ease, transform 160ms ease;
  }

  .mobile-trigger span,
  .mobile-trigger span::before,
  .mobile-trigger span::after {
    display: block;
    width: 18px;
    height: 2px;
    background: rgba(30, 41, 59, 0.9);
    border-radius: 999px;
    transition: transform 220ms ease, opacity 160ms ease;
  }

  .mobile-trigger span {
    position: relative;
  }

  .mobile-trigger span::before,
  .mobile-trigger span::after {
    content: '';
    position: absolute;
    left: 0;
  }

  .mobile-trigger span::before {
    top: -6px;
  }

  .mobile-trigger span::after {
    top: 6px;
  }

  .mobile-trigger:hover,
  .mobile-trigger:focus-visible {
    border-color: rgba(244, 63, 94, 0.35);
    transform: translateY(-1px);
  }

  .mobile-trigger:focus-visible {
    outline: 2px solid rgba(244, 63, 94, 0.45);
    outline-offset: 4px;
  }

  .mobile-trigger--active span {
    background: transparent;
  }

  .mobile-trigger--active span::before {
    transform: translateY(6px) rotate(45deg);
  }

  .mobile-trigger--active span::after {
    transform: translateY(-6px) rotate(-45deg);
  }

  .desktop-cta {
    display: none;
  }

  .mobile-overlay {
    position: fixed;
    inset: 0;
    background: var(--overlay-bg);
    backdrop-filter: blur(22px) saturate(160%);
    opacity: 0;
    visibility: hidden;
    transition: opacity 220ms ease, visibility 220ms ease;
    z-index: 45;
  }

  .mobile-overlay::before {
    content: '';
    position: absolute;
    inset: 0;
    background: var(--overlay-gradient);
    pointer-events: none;
  }

  .mobile-overlay--open {
    opacity: 1;
    visibility: visible;
  }

  .mobile-panel {
    position: relative;
    display: grid;
    grid-template-rows: 1fr auto;
    height: 100%;
    padding: 4.75rem 1.5rem 2.25rem;
    overflow: hidden;
    transform: translateY(28px);
    opacity: 0;
    transition: transform 260ms cubic-bezier(0.22, 1, 0.36, 1), opacity 220ms ease;
  }

  .mobile-overlay--open .mobile-panel {
    transform: translateY(0);
    opacity: 1;
  }

  .mobile-links {
    display: grid;
    align-content: start;
    gap: 0.8rem;
    padding: 0 0 1.2rem;
  }

  .mobile-link {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem 1.1rem;
    border-radius: 18px;
    border: 1px solid rgba(148, 163, 184, 0.18);
    background: rgba(255, 255, 255, 0.7);
    box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.6);
    color: rgba(30, 41, 59, 0.88);
    font: 500 1.05rem/1.4 "Inter", system-ui, sans-serif;
    letter-spacing: -0.01em;
    transition: border-color 160ms ease, transform 160ms ease, color 160ms ease, background 160ms ease;
    cursor: pointer;
  }

  .mobile-link:hover,
  .mobile-link:focus-visible {
    border-color: rgba(244, 63, 94, 0.35);
    color: var(--link-hover);
    transform: translateY(-2px);
  }

  .mobile-link:focus-visible {
    outline: 2px solid rgba(244, 63, 94, 0.35);
    outline-offset: 2px;
  }

  .mobile-cta-wrapper {
    display: grid;
    gap: 0.65rem;
    padding-top: 1.2rem;
  }

  .mobile-cta {
    width: 100%;
    padding-block: 1rem;
    font-size: 1.05rem;
  }

  .mobile-meta {
    text-align: center;
    font: 500 0.85rem/1.4 "Inter", system-ui, sans-serif;
    color: rgba(30, 41, 59, 0.55);
  }

  .nav--overlay .nav-surface {
    background: rgba(255, 255, 255, 0.68);
  }

  .lock-scroll {
    position: fixed;
    width: 100%;
    overflow: hidden;
  }

  @media (min-width: 768px) {
    .logo-img {
      height: 2.75rem;
    }

    .nav-inner {
      padding: 0 2rem;
    }
  }

  @media (min-width: 1024px) {
    .nav-inner {
      display: grid;
      grid-template-columns: auto 1fr auto;
      align-items: center;
    }

    .nav-links {
      display: inline-flex;
    }

    .desktop-cta {
      display: inline-flex;
    }

    .mobile-trigger {
      display: none;
    }
  }

  .reduce-motion * {
    transition-duration: 1ms !important;
  }
</style>